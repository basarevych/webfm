#!/bin/sh

a="/$0"; a=${a%/*}; a=${a:-.}; a=${a#/}/; basepath=$(cd $a; pwd)
if [ ! -d "$basepath" ]; then
    echo "Could not get base path"
fi

case $1 in
install)
  if [ `uname -s` = 'FreeBSD' ]; then
    conf_dir=/usr/local/etc/webfm
  else
    conf_dir=/etc/webfm
  fi

  mkdir -p $conf_dir
  if [ ! -f $conf_dir/webfm.conf ]; then
    cp $basepath/init/webfm.conf $conf_dir/webfm.conf
  fi
  ;;
pm2)
  echo $basepath/ecosystem.config.js
  ;;
run)
  env NODE_ENV=production node --preserve-symlinks $basepath/app.js
  ;;
*)
  echo "Usage: webfm [run|install|pm2]"
  exit 1
  ;;
esac

exit 0
