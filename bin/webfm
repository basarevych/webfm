#!/bin/sh

which realpath > /dev/null 2>&1
if [ $? -ne 0 ]; then
  echo "Please install realpath utility"
  exit 1
fi

basepath=`realpath $0`
basepath=`dirname "$basepath"`
basepath=`dirname "$basepath"`
basepath=`cd "$basepath" && pwd`
if [ ! -d "$basepath" ]; then
    echo "Could not get base path"
    exit 1
fi

case $1 in
install)
  if [ `uname -s` = 'FreeBSD' ]; then
    conf_dir=/usr/local/etc/webfm
  else
    conf_dir=/etc/webfm
  fi

  mkdir -p $conf_dir
  if [ ! -f $conf_dir/webfm.conf ]; then
    cp $basepath/init/webfm.conf $conf_dir/webfm.conf
  fi
  ;;
pm2)
  echo $basepath/ecosystem.config.js
  ;;
run)
  env NODE_ENV=production node --preserve-symlinks $basepath/app.js
  ;;
*)
  echo "Usage: webfm [run|install|pm2]"
  exit 1
  ;;
esac

exit 0
